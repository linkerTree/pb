syntax = "proto3";
//default go package name
package credential;
option  go_package = "github.com/linkerTree/pb/credential";

service UserCredentialValidator {
  // 尝试登陆的时候来验证密码是否正确
  rpc LoginByUserId(LoginByUserIdReq) returns (LoginByUserIdRsp);
  // 根据session ID检查登陆状态
  rpc CheckIsLoggingIn(CheckIsLoggingInReq) returns (CheckIsLoggingInRsp);
  // RegisterUser 用户注册
  rpc RegisterUser(RegisterUserReq) returns (RegisterUserRsp);
}

message LoginByUserIdReq {
  string userId = 1;
  string password = 2;
}
message LoginByUserIdRsp {
  string Error = 1;
  string sessionId = 2;
}

message CheckIsLoggingInReq {
  string sessionId = 1;
}
message CheckIsLoggingInRsp {
  string Error = 1;
  bool isLogging = 2;
  string userId = 3;
}

message RegisterUserReq {
  string userId = 1;
  string password = 2;
  string email = 3;
  string mobile = 4;
}
message RegisterUserRsp {
  string Error = 1;
  string sessionId = 2;
}

service UserPasswordRetriever {
  // 需求通过email发送验证码
  rpc GetVcodeWithEmail(GetVcodeWithEmailReq) returns (GetVcodeWithEmailRsp);
  // 检查验证码是否正确
  rpc ValidateEmailCode(ValidateEmailCodeReq) returns(ValidateEmailCodeRsp);
  // 通过mobile发送验证码
  rpc GetVcodeWithMobile(GetVcodeWithMobileReq) returns (GetVcodeWithMobileRsp);
  // 检查验证码是否正确
  rpc ValidateMobileCode(ValidateMobileCodeReq) returns(ValidateMobileCodeRsp);

  // 验证码正确的情况下，重置密码
  rpc ResetPasswordWithToken(ResetPasswordWithTokenReq) returns(ResetPasswordWithTokenRsp);
}

message GetVcodeWithEmailReq {
  string Email = 1;
}

message GetVcodeWithEmailRsp {
  string Error = 1;
}

message ValidateEmailCodeReq {
  string Email = 1;
  string Code = 2;
}
message ValidateEmailCodeRsp {
  string Error = 1;
  bool Valid = 2;
  string ResetPwdToken = 3;
}

message GetVcodeWithMobileReq {
  string mobile = 1;
}
message GetVcodeWithMobileRsp {
  string Error = 1;
}

message ValidateMobileCodeReq {
  string Mobile = 1;
  string Code = 2;
}

message ValidateMobileCodeRsp {
  string Error = 1;
  bool Valid = 2;
  string ResetPwdToken = 3;
}

message ResetPasswordWithTokenReq {
  string ResetPwdToken = 1;
  // hashed with pub
  string password = 2;
}

message ResetPasswordWithTokenRsp {
  // "" 或者具体的错误
  string Error = 1;
  string sessionId = 2;
  string UserID = 3;
}

