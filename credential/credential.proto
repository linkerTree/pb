syntax = "proto3";
//default go package name
package credential;
option  go_package = "github.com/linkerTree/pb/credential";

service UserCredentialValidator {
  // 获取一个public key
  rpc GetPublicKey(GetPublicKeyReq) returns (GetPublicKeyRsp);
  // 尝试登陆的时候来验证密码是否正确
  rpc ValidatePassWord(validatePassWordReq) returns (validatePassWordRsp);
  // 根据session ID检查登陆状态
  rpc CheckIsLoggingIn(CheckIsLoggingInReq) returns (CheckIsLoggingInRsp);
  // RegisterUser 用户注册
  rpc RegisterUser(RegisterUserReq) returns (RegisterUserRsp);
}

message GetPublicKeyReq{}
message GetPublicKeyRsp{
  bytes publicKey = 1;
}

message validatePassWordReq {
  string userName = 1;
  // 注意，这里是用公钥加密md5之后的密码
  bytes passHashedWithPub = 2;
}
message validatePassWordRsp {
  string error = 1;
  uint64 sessionID = 2;
}

message CheckIsLoggingInReq {
  uint64 sessionID = 1;
}
message CheckIsLoggingInRsp {
  bool isLogging = 1;
}

message RegisterUserReq {
  string userName = 1;
  bytes passHashedWithPub = 2;
  string email = 3;
}
message RegisterUserRsp {
  string error = 1;
}